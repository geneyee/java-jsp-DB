package examjdbc01;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.Date;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import examjdbc02.JdbcConnectionUtil;
import examjdbc02.MemberVo;

public class MemberDao {
	// db 역할
	private Map<Integer, MemberVo> db = new HashMap<>();
	
	// C
	public void insertMember(MemberVo vo) {
		vo.setRegdate(new Date());
		db.put(vo.getNum(), vo);
	}
	
	// R
	public MemberVo selectMember(int num) {
		return db.get(num);
	}
	
	public List<MemberVo> selectAll(){
		Connection conn = null;
		PreparedStatement pstmt = null;
		ResultSet rs = null;
		try {
			conn = util.getConnection();
			System.out.println("접속 성공");
			pstmt = conn.prepareStatement("select * from member");
			rs = pstmt.executeQuery(); // 쿼리 전송해서 결과

			while (rs.next()) {
				MemberVo vo = new MemberVo(
						rs.getInt(1), 
						rs.getString(2), 
						rs.getString("memberpw"), 
						rs.getString(4));

				vo.setRegdate(rs.getDate("regdate"));
				System.out.println(vo);
			}

		} catch (SQLException e) {
			e.printStackTrace();
		} finally {
			util.close(rs);
			util.close(pstmt);
			util.close(conn);
		}
	}
	
	// U
	public void updateMember(MemberVo vo) {
		db.put(vo.getNum(), vo);
	}
	
	// D
	public void deleteMember(int num) {
		db.remove(num);
	}
	
	public void deleteAll() {
		db.clear();
	}
}
