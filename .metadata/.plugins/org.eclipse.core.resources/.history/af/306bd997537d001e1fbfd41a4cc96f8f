package exam03;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.Date;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import examjdbc01.JdbcConnectionUtil;
import examjdbc01.MemberVo;

public class MemberDao {
	private JdbcConnectionUtil util;
	
	public MemberDao() {
		util = JdbcConnectionUtil.getInstance();
	}
	
	// C
	public void inserMember(MemberVo vo) {
		Connection conn = null;
		 PreparedStatement pstmt = null;
		 int result = 0;

			try {
				conn = util.getConnection();
				System.out.println("접속 성공");
				
				StringBuffer query = new StringBuffer();
				query.append("insert into member ");
				query.append("(num, memberid, memberpw, nickname, regdate) ");
				query.append("values (MEMBER_SEQ.nextval, ?, ?, ?, sysdate)");
				System.out.println(query.toString());
				
				
				pstmt = conn.prepareStatement(query.toString());
				pstmt.setString(1, "tester");
				pstmt.setString(2, "1234");
				pstmt.setString(3, "testernick");
				result = pstmt.executeUpdate(); // 쿼리 전송해서 결과 
				System.out.println(result + "행이 삽입되었습니다.");
				
			} catch(SQLException e) {
				e.printStackTrace();
			} finally {
				util.close(pstmt);
				util.close(conn);
			}
	}
	
	// R
	public MemberVo selectMember(int num) {
		return db.get(num);
	}
	
	public List<MemberVo> selectAll(){
		return new ArrayList<MemberVo>(db.values());
	}
	
	// U
	public void updateMember(MemberVo vo) {
		db.put(vo.getNum(), vo);
	}
	
	// D
	public void deleteMember(int num) {
		db.remove(num);
	}
	
	public void deleteAll() {
		db.clear();
	}
}
